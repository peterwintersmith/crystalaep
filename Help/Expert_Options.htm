<html>
 <head>
  <title></title>
 </head>
 <body>
  <h3><u><b>Expert Options</b></u></h3>
  <p width="95%">
  This help section provides an overview of how to operate the Expert Options configuration dialog. <font color="red">Please do not make changes to the Expert Options unless you understand the implications of the changes being made otherwise protected programs may fail to run properly</font>. The Expert Options form appears as follows:
  </p>
  <img src="ExpertOOverview.png" />
  <h4><u>Protected Processes</u></h4>
  <p width="95%">
  The Protected Processes view within the Expert Options operates in a similar fashion to the equivalent list within the Basic Options form. Protected processes are listed by executable name rather than program name as is also the case for the Basic Options (for example Microsoft Word is listed by the executable name winword.exe rather than the name of the program). Protected programs can be added by executable name using the Add button or removed by selecting the program to be removed from the list and then clicking the Remove button.
  </p>
  <h4><u>Protection Methods</u></h4>
  <p width="95%">
  The Protection Methods view displays a tabbed selection of the various key protection features offered by Crystal. By default changing these settings will take effect for all protected programs on the system unless they have been configured with individual protection settings. To change protection settings for a specifically application it is necessary to first select the program for which settings are to be configured from the Protected Process list (in the Protected Processes view) and to select Edit Configuration under the protected processes list.
  </p>
  <p width="95%">
   <b>Connection Monitor</b><br>
   The Connection Monitor tab within the Protection Methods view allows a user to configure filtering settings for data sent to and from the web browser (at present only Internet Explorer is supported). The Connection Monitor tab appears as follows:
  </p>
  <img src="ExpertOConnMon.png" />
  <p width="95%">
  The Crystal product comes with several filters for protecting against certain common attacks against web-sites the user may trust, and certain filters for protecting the browser from malformed images which may be utilised by an attacker to try and crash or run malicious code within the browser.<br><br>
  There are three types of filters:<br><br>
  <b>Connect Filters</b> - These filters are responsible for validating connection attempts before they are carried out by the browser. For example, if the browser is attempting to establish an HTTP (or HTTPS) connection with http://www.example.com/login.aspx the filters will receive notification of the attempt to connect to www.example.com and will be able to examine the file on the server being requested (/login.aspx) before the connection is made. A filter can either allow the connection or disallow it. Filters are invoked one by one until either all allow the connection or one disallows it (in which case the browser is prevented from connecting).<br><br>
  <b>Outgoing Data Filters</b> - These filters are responsible for validating data sent from the browser to a website. These filters have the ability to either allow the outgoing data to be sent to the remote website, to rewrite the data being sent (for example, to remove personal information or mitigate a web-based threat) or to block the data from being sent altogether.<br><br>
  <b>Incoming Data Filters</b> - These filters are responsible for validating data received by the browser in response to a request made to a website. Often web-sites can return malicious content to the browser which can be detected through signatures, behaviours or other analysis of the data being received. These filters have the ability to scan incoming data, to allow it to pass through to the browser, to block it altogether or to rewrite the data so that it is safe for processing by the browser.<br><br>
  </p>
  <p width="95%">
  Occasionally a user may wish to enable filters performing one class of inspection and disable another, for example a user may wish to enable validating of incoming data but disable filtering of outgoing data or connection attempts. This can be done easily through the use of the Enable check-boxes in the Connection Monitor view:
  </p>
  <img src="ExpertOFilterSettings.png" />
  <p width="95%">
  The filters view of the Connection Monitor tab allows a user to see which filters are currently installed for validating connection attempts, and ingoing/outgoing data. The filters are listed in tabs separated by category:
  </p>
  <img src="ExpertOConnMonFilt.png" />
  <p width="95%">
  Filters can be configured using the Manage Filters form. To view information on how to do this, please navigate to the Manage Filters help topic.
  </p>
  <h4><u>Memory Monitor</u></h4>
  <p width="95%">
  The Memory Monitor tab within the Protection Methods view allows a user to configure some of the methods which are enabled to allow protected applications defense against some of the most potent attacks against software - attacks which are often employed by malware to force installation or which are exploited during attempts to hack high profile users - heap memory corruption attacks. The Memory Monitor tab appears as follows:
  </p>
  <img src="ExpertOMemMonOverview.png" />
  <p width="95%">
  The options which are presented in this form are as follows:<br><br>
  <b>Vary Allocation Sizes</b> - This option ensures that memory layout is generally nondeterministic by varying the sizes of memory allocation attempts made by a protected program. Modifying memory layout in an unpredictable fashion helps mitigate the likelihood of certain memory corruption exploits from succeeding as an attacker will have a more difficult time coercing memory layout into a structure which is advantageous for him in launching an attempt to run code.<br><br>
  <b>Set Terminate on Corruption</b> - Microsoft Windows provides a setting which an application can apply to the dynamic memory structures (heaps) which it creates which ensures that, if Windows detects the memory is corrupt, the program is terminated. Enabling this feature applies this protection feature to all heaps created by the protect application.<br><br>
  <b>Windows Validate Allocations</b> - This flag forces Microsoft Windows to validate a heap structure every time an allocation is performed. This generally tends to slow down an application significantly and is set to disabled by all configurations of Crystal, however is provided as an option for the most careful of users. It is not generally recommended this feature is employed and the author has not investigated the ease with which Windows heap validation can be bypassed as it is unlikely that this feature was designed to be a security feature first and foremost.<br><br>
  <b>Crystal Validate Allocations</b> - This options enables Crystal to ensure that adjoining heap memory allocations have not been corrupted before performing a heap operation. This feature is designed with security in mind and should assist in mitigating exploitation of many heap memory corruption issues.<br><br>
  <b>Enable Process DEP</b> - Microsoft Windows provides a feature to enable process Data Execution Prevention (DEP), a feature which the Operating System provides to help mitigate attacks in which malicious code is inserted into allocated memory and is subsequently executed via a software vulnerability by removing the ability to execute writeable memory. There are methods to disable this feature on some versions of Windows if it is enabled, however enabling it provides an additional layer of defense against malicious code.<br><br>
  <b>Wipe Allocations on Free</b> - Clearing memory which is returned to the operating system by a protected program is an easy way to mitigate certain re-use problems and to generally increase the security of an application. Certain attacks require memory to retain the contents it had prior to the attack (for example, to contain pointers which are later leveraged to achieve code execution. Enabling this setting helps mitigate the risk from exploits requiring this behaviour.<br><br>
  <b>Use-After-Free Protection</b> - A category of attacks employed often against web browser technology involves the use of allocated memory which was once trusted (e.g. which represented some program data objects - for example a text-box in a web page, an image or an instance of a browser plug-in) which has been re-used inappropriately in a fashion that can allow an attacker to maliciously control the behaviour of the program. Enabling this feature provides some layer of defense against attacks of this nature.<br><br>
  <b>Double-Free Protection</b> - Enabling this feature provides additional defense against a similar flaw to that which is protected by Use-After-Free Protection. If use-after-free protection is desired it is recommended that this protection method be enabled in addition, as it complements the latter protection strategy.<br><br>
  <b>Max. Monitoring Sensitivity</b> - This feature forces heap monitoring to be a bit more sensitive, allowing some applications which would not tolerate heap monitoring well to be protected using the above features. This setting is not generally required to protect a process and is best left disabled unless heap protection causes applications to crash.<br><br>
  </p>
  <h4><u>API Monitor</u></h4>
  <p width="95%">
  The API monitor provides several defenses to a protected application from abuse of Operating System Application Programming Interface (API) functions. The defensive strategies employed involve inserting additional checks at key points within program execution in an attempt to scupper attempts to execute malicious code or to add behaviours to the API to allow Crystal some level of control over API which can be abused by applications to an attacker's advantage. The API Monitor tabs appears as follows:
  </p>
  <img src="ExpertOApiMonOverview1.png" />&nbsp;<img src="ExpertOApiMonOverview2.png" />
  <p width="95%">
  The options which are presented in this form are as follows:<br><br>
  <u>General Settings</u><br><br>
  <b>Block Code from Temp Dir.</b> - When enabled this setting disables code modules (DLLs) from being loaded from the Windows Temp directory. Program executables are also blocked if they originate within the Temp directory. This setting may protect against some attacks which rely on cached executable content as the Temp directory is a popular location for such attacks.<br><br>
  <b>Block Code from Net. Share</b> - When enabled this setting disables code modules from being loaded from a remote network share. Program executables are also blocked if they originate from a remote network share. This may help mitigate certain attacks which can be performed by forcing the browser into attempting to load code from the program Current Directory, where the Current Directory is a remote attacker controlled location. This is not always effective in blocking "binary planting" attacks as Crystal will not always load into the target application in time to prevent remote DLL loading, so an additional layer of defense is the executable white-list (preventing a program which is vulnerable to "binary planting" attacks from being run by a protected application - i.e. the browser).<br><br>
  <b>Block Code with Long Path</b> - When enabled this setting prevent DLLs and executables containing code from being loaded from paths with a long (unicode) file-name. Long unicode filenames may be used to bypass certain length-limited file verification functions.<br><br>
  <b>Block Code from Inet. Temp.</b> - When enabled this setting disables code modules (DLLs) from being loaded from the Internet Explorer Temp directory. Program executables are also blocked if they originate within the Internet Explorer Temp directory. As programs run from Internet Explorer directly and all temporarily downloaded code ends up in the Internet Explorer cache by default, blocking code from being loaded from this location may help lower the risk of exploitation of certain classes of vulnerability.<br><br>
  <b>Block Code from \Downloads\</b> - When enabled this setting disables code modules (DLLs) from being loaded from a directory contains \Downloads\ in the path. Program executables are also blocked if they originate within the Temp directory. Certain classes of "binary planting" attack require that malicious code modules be downloaded into an application's default downloads folder (often C:\Users\&lt;username&gt;\Downloads\) to be loaded by a vulnerable application. Enabling this setting helps to mitigate such an attack.<br><br>
  <b>Anti-DLL Planting Checks</b> - This setting provides some protection against DLL planting attacks in which a malicious code module is placed on a network file share alongside a file of a type usually considered safe (for example, a Word document, image or media file). The program under attack is fooled into loading the malicious code module when the program starts as it dangerously includes the network file share in a list of trusted paths from which code modules can be loaded.<br><br>
  <b>Run in Child Processes</b> - This setting dictates whether or not Crystal should attempt to load itself into programs being started by protected applications regardless of whether or not the protected application is on the Protected Processes list.<br><br>
  <b>Prompt User on Exe Blocked</b> - If a protected application attempts to execute a program not on the executable whitelist it will be denied and the program will not start unless this options is enabled in which case the user will be prompted to make a decision as to whether the program in question should be permitted to run or not.<br><br>
  <b>Run Protected Apps Without Warning</b> – This setting enables Crystal to run applications on the protected processes list without prompting the user (for example, if Microsoft Word and Internet Explorer are both on the list, then Internet Explorer will be allowed to run Word without warning the user – of course this does not undermine the default behaviour, if a user would be warned by Internet Explorer normally they still will be).<br><br>
  <b>Prompt to Relax Protection for .NET Applications</b> - Certain applications powered by the Microsoft .NET technology (for example Silverlight-based websites) require some of the protection methods offered by Crystal to be relaxed to ensure that they are able to operate correctly. Some users may wish to be warned before protection levels are relaxed and to have the opportunity to override the behaviour of Crystal in this respect. To receive a warning before Crystal performs such a downgrade ensure that this check-box is toggled.<br><br>
  <b>Anti-ROP Stack</b> - This setting when enabled performs additional monitoring of thread stacks within a protected process to determine whether or not a return-oriented-programming (ROP) attack is in progress. This setting may help defeat some more advanced exploits against later versions of Microsoft Windows (exploits which attempt to bypass Windows' built-in defenses).<br><br>
  <b>Disable RWX Memory (Soft)</b> - When enabled this setting helps to prevent applications from requesting memory which can be read/written AND executed. This helps protect against many different types of threat by making it difficult for malicious code to be written to executable memory. As certain programs require the existence of read/write/execute memory (for example .NET applications, Java and Flash) this setting may interfere with some software causing it to crash or operate inappropriately. If it is known that a given protected application will not require read/write/execute memory, this setting can provide a powerful defense against the execution of malicious code.<br><br>
  <b>Disable RWX Stack (Soft)</b> - This setting when enabled prevents thread stacks from being marked executable. This helps mitigate one of the most common methods of executing malicious code within a protected application (direct stack buffer overflow attacks).<br><br>
  <b>Monitor Call Origins</b> - When enabled this feature helps to prevent untrusted code (code running in untrusted memory) from calling certain key API functions, aborting the protected program when such a call takes place.<br><br>
  <b>Randomize Allocation Bases</b> - When enabled this feature attempts to randomise the base address (location) of memory pages requested by a protected application in an attempt to make it difficult for an attacker to predict memory layout and hence complicating attempts to run malicious code. Enabling this feature may have some performance impact on applications with a long life-span, though the impact should not be too significant.<br><br>
  <b>Watch Exception Dispatcher</b> - This feature monitors the Windows exception dispatcher in an attempt to detect attempts to execute malicious code through corruption of the exception handling mechanism - a popular technique for running code used by attackers.<br><br>
  <b>Emulate Exception Handlers</b> - This feature emulates certain aspects of exception handlers before allowing them to execute in an attempt to determine whether they are attempting a dangerous code sequence (i.e. a sequence which will give control to attacker injected code). This feature is a backstop against certain exploits and is not particularly full-featured.<br><br>
  <b>Module RWX Whitelist</b> - The RWX whitelist provides a list of DLL (executable code module) names which are permitted to request read/write and execute memory. Since the author recognises that restricting entirely an application's ability to request such memory may greatly constrain the number of applications which can take advantage of the "Disable RWX Memory (Soft)" feature, this list of modules which are permitted to request read/write/execute memory serves as a method for giving a trusted module a method of operating properly while still providing protection against many common attacks. The best configuration possible is for this list to be empty, as then for the most-part no modules are trusted with such potentially dangerous regions of memory.<br><br>
  <b>Executable Whitelist</b> - The executable whitelist defines a list of programs by executable name which are trusted for execution without raising a prompt to the user (though their execution is still logged in an alert). If this feature is enabled and the whitelist is empty, no programs are allowed to execute without prompting the user first.
  </p>
  <h4><u>COM/ActiveX Monitor</u></h4>
  <p width="95%">
  The COM/ActiveX Monitor feature allows a user to protect applications by limiting which safe-for-scripting or safe-for-initialisation ActiveX modules can be loaded within a protected program. A user can implement either a white-list (in which only ActiveX controls on the list are permitted) or a black-list (in which all except ActiveX controls on the list are are permitted) depending on the level of restriction which is desirable for protected applications. The COM/ActiveX Monitor does not filter COM objects which are not marked as safe-for-scripting or initialisation. The feature appears as follows:
  </p>
  <img src="ExpertOCOMMonOverview.png" />
  <p width="95%">
  The options presented by the COM/ActiveX Monitor are laid in in three tabbed pages with the following titles:<br><br>
  <u>CLSID Whitelist</u> and <u>CLSID Blacklist</u><br><br>
  The CLSID text-box allows a user to add a COM class-id to either the black-list or white-list by entering the class-id (e.g. {4A9A44B9-7C26-4B20-831C-FF45404C3C4F}) and by clicking Add. Selecting a CLSID from the black-list or white-list and choosing Remove will remove the class-id from the respective list.<br><br>
  <b>Auto Populate Blacklist</b> - This button allows a user to automatically populate the blacklist with class-ids which are marked safe-for-scripting or safe-for-initialisation. As this list will contain controls which a user may wish to permit, so it may be necessary to remove certain class-ids from the list after the blacklist is populated.
  </p>
  <img src="ExpertOCOMMonReqJit.png" />
  <p width="95%">
  <u>CLSID Requiring JIT</u><br><br>
  The CLSID Requiring JIT feature enables selecting disabling of the API Monitor "Disable RWX Memory (Soft)" feature to allow certain ActiveX objects which require the ability to dynamically compile (JIT compile) and execute code from pages with read/write and execute permissions. If a class-id is added to this list the user will be prompted whenever an attempt to instantiate the assocated COM object occurs and will be able to allow or deny the instantiation and the relaxing of the "Disable RWX Memory (Soft)" protection method.<br><br>
  <b>Persist JIT Decision</b> - If this check-box is selected then any decision made by the user to allow or disallow loading of an ActiveX requiring JIT compilation is persisted for the life-time of the application (i.e. when the application is closed the decision is reset). This avoids the need to continue to prompt the user on a case-by-case basis (which is often a serious interruption for applications such as Internet Explorer as the user is warned every time a page containing Flash content - for example - is loaded).<br><br>
  </p>
 </body>
</html>
